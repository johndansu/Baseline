<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Baseline - Operations Dashboard Template</title>
  <meta name="description" content="Baseline dashboard template for policy status, scans, API key operations, and monitoring.">
  <link rel="icon" type="image/png" sizes="32x32" href="../img/baseline favicon.png">
  <link rel="apple-touch-icon" href="../img/baseline favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./dashboard.css">
</head>
<body class="dashboard-page">
  <a class="skip-link" href="#dashboard-content">Skip to main content</a>
  <div class="dashboard-shell">
    <aside class="dashboard-sidebar">
      <a class="dashboard-brand" href="./index.html">
        <img src="../img/baseline logo.png" alt="Baseline logo">
        <div>
          <strong>Baseline</strong>
          <span>Operations Dashboard</span>
        </div>
      </a>

      <nav class="dashboard-nav" aria-label="Dashboard sections" role="tablist">
        <button class="dashboard-nav-item active" id="tab-overview" type="button" role="tab" aria-selected="true" aria-controls="overview" tabindex="0" data-section="overview">Overview</button>
        <button class="dashboard-nav-item" id="tab-policies" type="button" role="tab" aria-selected="false" aria-controls="policies" tabindex="-1" data-section="policies">Policies</button>
        <button class="dashboard-nav-item" id="tab-scans" type="button" role="tab" aria-selected="false" aria-controls="scans" tabindex="-1" data-section="scans">Scans</button>
        <button class="dashboard-nav-item" id="tab-api-keys" type="button" role="tab" aria-selected="false" aria-controls="api-keys" tabindex="-1" data-section="api-keys">API Keys</button>
        <button class="dashboard-nav-item" id="tab-monitoring" type="button" role="tab" aria-selected="false" aria-controls="monitoring" tabindex="-1" data-section="monitoring">Monitoring</button>
      </nav>

      <p class="dashboard-note">Template only. Backend integration is not enabled yet.</p>
    </aside>

    <main class="dashboard-main" id="dashboard-content">
      <header class="dashboard-header panel">
        <div class="dashboard-header-primary">
          <p class="eyebrow">Release Governance</p>
          <h1>Operations Dashboard</h1>
        </div>
        <div class="header-actions">
          <span class="pill">Environment: Production</span>
          <button type="button">Run Scan</button>
        </div>
      </header>

      <section class="dashboard-section active" id="overview" role="tabpanel" aria-labelledby="tab-overview" data-testid="section-overview">
        <div class="kpi-grid">
          <article class="kpi-card"><span>Policy Pass Rate</span><strong>96%</strong></article>
          <article class="kpi-card"><span>Blocking Violations</span><strong>1</strong></article>
          <article class="kpi-card"><span>Scans (24h)</span><strong>42</strong></article>
          <article class="kpi-card"><span>Audit Events</span><strong>1,247</strong></article>
        </div>

        <article class="panel">
          <h2>Operational States</h2>
          <div class="state-grid">
            <div class="state-card">
              <span class="state-label info">Loading</span>
              <p>Collection job is running. Keep previous data visible until refresh completes.</p>
            </div>
            <div class="state-card">
              <span class="state-label neutral">Empty</span>
              <p>No events for this window. Show setup guidance rather than blank tables.</p>
            </div>
            <div class="state-card">
              <span class="state-label warn">Stale</span>
              <p>Snapshot older than SLA. Display warning and trigger quick health check.</p>
            </div>
            <div class="state-card">
              <span class="state-label danger">Error</span>
              <p>Data pipeline failed. Surface action owner and a one-click retry path.</p>
            </div>
            <div class="state-card">
              <span class="state-label muted">Access Denied</span>
              <p>Role lacks scope. Keep panel metadata visible and show required permission.</p>
            </div>
          </div>
        </article>

        <div class="split-grid">
          <article class="panel">
            <h2>Current Release Status</h2>
            <ul class="status-list">
              <li><span class="ok">Pass</span><span>CI and security checks</span></li>
              <li><span class="warn">Pending</span><span>One rollback documentation review</span></li>
              <li><span class="ok">Pass</span><span>Signed release artifacts</span></li>
            </ul>
          </article>
          <article class="panel">
            <h2>Recent Activity</h2>
            <ul class="status-list">
              <li><span class="ok">16:42</span><span>Policy check completed</span></li>
              <li><span class="ok">16:36</span><span>SARIF uploaded</span></li>
              <li><span class="ok">16:28</span><span>API health check complete</span></li>
            </ul>
          </article>
        </div>

        <div class="split-grid">
          <article class="panel">
            <h2>Today Checklist</h2>
            <ul class="plain-list">
              <li>Run `baseline check` before merge window.</li>
              <li>Review blocking policy queue.</li>
              <li>Confirm release artifacts are signed.</li>
            </ul>
          </article>
          <article class="panel">
            <h2>Quick Links</h2>
            <ul class="plain-list">
              <li>Open latest CI run and inspect security job output.</li>
              <li>Review `/v1/audit/events` for key lifecycle changes.</li>
              <li>Run `baseline api verify-prod --strict` after config edits.</li>
            </ul>
          </article>
        </div>

        <article class="panel">
          <div class="panel-head">
            <h2>Open Items</h2>
            <div class="table-controls">
              <label>
                Search
                <input type="search" id="openItemsFilter" placeholder="Filter rows">
              </label>
              <label>
                View State
                <select id="openItemsState">
                  <option value="table">Table</option>
                  <option value="loading">Loading</option>
                  <option value="empty">Empty</option>
                  <option value="error">Error</option>
                  <option value="stale">Stale</option>
                  <option value="denied">Access Denied</option>
                </select>
              </label>
            </div>
          </div>
          <div class="table-states" id="openItemsStates" aria-live="polite" hidden>
            <p class="table-state" data-state="loading">Loading open items snapshot...</p>
            <p class="table-state" data-state="empty">No follow-up items in this window.</p>
            <p class="table-state" data-state="error">Unable to load open items. Retry after pipeline check.</p>
            <p class="table-state" data-state="stale">Snapshot is stale. Last refresh was over 15 minutes ago.</p>
            <p class="table-state" data-state="denied">You do not have permission to view item-level data.</p>
          </div>
          <p class="table-state no-match" id="openItemsNoMatch" aria-live="polite" hidden>No rows match your current filter.</p>
          <div class="table-wrap" id="openItemsWrap">
            <table class="data-table" id="openItemsTable" data-testid="table-open-items">
            <caption class="sr-only">Open delivery and release follow-up items</caption>
            <thead>
              <tr>
                <th aria-sort="none"><button class="sort-button" type="button" data-table="openItemsTable" data-col="0">Item</button></th>
                <th aria-sort="none"><button class="sort-button" type="button" data-table="openItemsTable" data-col="1">Owner</button></th>
                <th aria-sort="none"><button class="sort-button" type="button" data-table="openItemsTable" data-col="2">Due</button></th>
                <th aria-sort="none"><button class="sort-button" type="button" data-table="openItemsTable" data-col="3">Status</button></th>
              </tr>
            </thead>
            <tbody>
              <tr><td>Rollback doc review</td><td>Platform</td><td>Today</td><td class="warn-text">Pending</td></tr>
              <tr><td>Key rotation confirmation</td><td>Security</td><td>Today</td><td class="ok-text">Complete</td></tr>
              <tr><td>Release notes verification</td><td>Release Manager</td><td>Tomorrow</td><td class="warn-text">In Progress</td></tr>
            </tbody>
          </table>
          </div>
        </article>
      </section>

      <section class="dashboard-section" id="policies" role="tabpanel" aria-labelledby="tab-policies" data-testid="section-policies" hidden>
        <article class="panel">
          <h2>Policy Summary</h2>
          <table class="data-table">
            <caption class="sr-only">Policy obligation status across configured rules</caption>
            <thead>
              <tr>
                <th>Policy</th>
                <th>Description</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>A1</td><td>Protected primary branch</td><td class="ok-text">Pass</td></tr>
              <tr><td>B1</td><td>PR-triggered CI with tests</td><td class="ok-text">Pass</td></tr>
              <tr><td>D1</td><td>No plaintext secrets</td><td class="ok-text">Pass</td></tr>
              <tr><td>R1</td><td>Rollback plan required</td><td class="warn-text">Pending</td></tr>
            </tbody>
          </table>
        </article>
      </section>

      <section class="dashboard-section" id="scans" role="tabpanel" aria-labelledby="tab-scans" data-testid="section-scans" hidden>
        <article class="panel">
          <h2>Scan Commands</h2>
          <pre><code>baseline check
baseline scan
baseline report --json
baseline report --sarif</code></pre>
        </article>
        <article class="panel">
          <div class="panel-head">
            <h2>Latest Scan Snapshot</h2>
            <div class="table-controls compact">
              <label>
                Result
                <select id="scanResultFilter">
                  <option value="all">All</option>
                  <option value="pass">Pass</option>
                  <option value="blocked">Blocked</option>
                </select>
              </label>
            </div>
          </div>
          <div class="table-wrap">
            <table class="data-table" id="scanTable" data-testid="table-scans">
            <caption class="sr-only">Latest compliance scan execution summary</caption>
            <thead>
              <tr>
                <th aria-sort="none"><button class="sort-button" type="button" data-table="scanTable" data-col="0">Time</button></th>
                <th aria-sort="none"><button class="sort-button" type="button" data-table="scanTable" data-col="1">Files</button></th>
                <th aria-sort="none"><button class="sort-button" type="button" data-table="scanTable" data-col="2">Violations</button></th>
                <th aria-sort="none"><button class="sort-button" type="button" data-table="scanTable" data-col="3">Result</button></th>
              </tr>
            </thead>
            <tbody>
              <tr><td>16:42</td><td>247</td><td>1</td><td class="warn-text">Blocked</td></tr>
              <tr><td>14:10</td><td>247</td><td>0</td><td class="ok-text">Pass</td></tr>
            </tbody>
          </table>
          </div>
        </article>
      </section>

      <section class="dashboard-section" id="api-keys" role="tabpanel" aria-labelledby="tab-api-keys" data-testid="section-api-keys" hidden>
        <div class="split-grid">
          <article class="panel">
            <h2>Generate API Key (Dashboard Template)</h2>
            <form class="keygen-form" id="keygenForm">
              <label>
                Key Name
                <input id="keyName" type="text" value="dashboard-operator" required>
              </label>
              <label>
                Role
                <select id="keyRole">
                  <option value="admin">admin</option>
                  <option value="viewer">viewer</option>
                </select>
              </label>
              <label>
                Environment
                <select id="keyEnv">
                  <option value="production">production</option>
                  <option value="staging">staging</option>
                  <option value="development">development</option>
                </select>
              </label>
              <button type="submit">Generate Template Key</button>
            </form>
            <p class="template-note">Template mode: this action does not create a backend key.</p>
            <pre class="keygen-result" id="keygenResult" aria-live="polite"><code>Generated key preview will appear here.</code></pre>
          </article>

          <article class="panel">
            <h2>CLI / API Method (Real)</h2>
            <pre><code># CLI
baseline api keygen

# configure single key
BASELINE_API_KEY=&lt;your_generated_key&gt;
baseline api serve --addr :8080

# API key lifecycle (admin required)
curl -X POST \
  -H "Authorization: Bearer &lt;admin_key&gt;" \
  -H "Content-Type: application/json" \
  -d "{\"name\":\"ci-runner\",\"role\":\"viewer\"}" \
  http://127.0.0.1:8080/v1/api-keys

# list key metadata
curl -H "Authorization: Bearer &lt;admin_key&gt;" \
  http://127.0.0.1:8080/v1/api-keys

# revoke managed key
curl -X DELETE \
  -H "Authorization: Bearer &lt;admin_key&gt;" \
  http://127.0.0.1:8080/v1/api-keys/&lt;key_id&gt;</code></pre>
          </article>
        </div>

        <article class="panel">
          <h2>Operational Rules</h2>
          <ul class="plain-list">
            <li>Create separate keys per environment and workload.</li>
            <li>Use `viewer` keys for read-only automation.</li>
            <li>Use `admin` keys only for lifecycle operations.</li>
            <li>Rotate keys on schedule and after any exposure event.</li>
            <li>Prefer managed API keys for revoke/audit visibility.</li>
          </ul>
        </article>
      </section>

      <section class="dashboard-section" id="monitoring" role="tabpanel" aria-labelledby="tab-monitoring" data-testid="section-monitoring" hidden>
        <article class="panel">
          <h2>Monitoring Commands</h2>
          <pre><code>baseline api verify-prod --strict
baseline check
baseline report --json
baseline report --sarif
curl http://127.0.0.1:8080/healthz
curl http://127.0.0.1:8080/readyz
curl -H "Authorization: Bearer &lt;api_key&gt;" \
  http://127.0.0.1:8080/v1/audit/events</code></pre>
        </article>
      </section>
    </main>
  </div>

  <script>
    (function () {
      var navItems = Array.prototype.slice.call(document.querySelectorAll(".dashboard-nav-item"));
      var sections = Array.prototype.slice.call(document.querySelectorAll(".dashboard-section"));
      var keygenForm = document.getElementById("keygenForm");
      var keygenResult = document.getElementById("keygenResult");
      var openItemsFilter = document.getElementById("openItemsFilter");
      var openItemsState = document.getElementById("openItemsState");
      var openItemsStates = document.getElementById("openItemsStates");
      var openItemsNoMatch = document.getElementById("openItemsNoMatch");
      var openItemsWrap = document.getElementById("openItemsWrap");
      var openItemsTable = document.getElementById("openItemsTable");
      var scanResultFilter = document.getElementById("scanResultFilter");
      var scanTable = document.getElementById("scanTable");
      var sortState = {};

      function validSectionId(id) {
        return sections.some(function (section) { return section.id === id; });
      }

      function showSection(sectionId) {
        if (!validSectionId(sectionId)) {
          sectionId = "overview";
        }

        navItems.forEach(function (item) {
          var isActive = item.getAttribute("data-section") === sectionId;
          item.classList.toggle("active", isActive);
          item.setAttribute("aria-selected", isActive ? "true" : "false");
          item.setAttribute("tabindex", isActive ? "0" : "-1");
        });
        sections.forEach(function (section) {
          var isVisible = section.id === sectionId;
          section.classList.toggle("active", isVisible);
          section.hidden = !isVisible;
        });

        if (window.location.hash !== "#" + sectionId) {
          try {
            history.replaceState(null, "", "#" + sectionId);
          } catch (err) {
            window.location.hash = sectionId;
          }
        }
      }

      navItems.forEach(function (item) {
        item.addEventListener("click", function () {
          showSection(item.getAttribute("data-section"));
        });

        item.addEventListener("keydown", function (event) {
          var idx = navItems.indexOf(item);
          var nextIdx = idx;

          if (event.key === "ArrowDown" || event.key === "ArrowRight") {
            nextIdx = (idx + 1) % navItems.length;
          } else if (event.key === "ArrowUp" || event.key === "ArrowLeft") {
            nextIdx = (idx - 1 + navItems.length) % navItems.length;
          } else if (event.key === "Home") {
            nextIdx = 0;
          } else if (event.key === "End") {
            nextIdx = navItems.length - 1;
          } else {
            return;
          }

          event.preventDefault();
          var target = navItems[nextIdx];
          showSection(target.getAttribute("data-section"));
          target.focus();
        });
      });

      function parseSortableValue(value) {
        var normalized = value.trim().toLowerCase();
        if (/^\d+(\.\d+)?$/.test(normalized)) {
          return { type: "number", value: Number(normalized) };
        }
        if (/^\d{1,2}:\d{2}$/.test(normalized)) {
          var parts = normalized.split(":");
          return { type: "number", value: Number(parts[0]) * 60 + Number(parts[1]) };
        }
        return { type: "string", value: normalized };
      }

      function sortTable(table, colIndex, direction) {
        if (!table || !table.tBodies || !table.tBodies[0]) {
          return;
        }

        var tbody = table.tBodies[0];
        var rows = Array.prototype.slice.call(tbody.rows);
        rows.sort(function (a, b) {
          var left = parseSortableValue(a.cells[colIndex].textContent);
          var right = parseSortableValue(b.cells[colIndex].textContent);
          var result = 0;

          if (left.type === "number" && right.type === "number") {
            result = left.value - right.value;
          } else {
            if (left.value < right.value) {
              result = -1;
            } else if (left.value > right.value) {
              result = 1;
            }
          }

          return direction === "asc" ? result : -result;
        });

        rows.forEach(function (row) {
          tbody.appendChild(row);
        });
      }

      function bindSortButtons() {
        var buttons = Array.prototype.slice.call(document.querySelectorAll(".sort-button"));
        buttons.forEach(function (button) {
          button.addEventListener("click", function () {
            var tableId = button.getAttribute("data-table");
            var col = Number(button.getAttribute("data-col"));
            var table = document.getElementById(tableId);
            if (!table) {
              return;
            }

            var key = tableId + ":" + col;
            var nextDirection = sortState[key] === "asc" ? "desc" : "asc";
            sortState = {};
            sortState[key] = nextDirection;

            var headers = Array.prototype.slice.call(table.querySelectorAll("thead th"));
            headers.forEach(function (th, index) {
              th.setAttribute("aria-sort", index === col ? (nextDirection === "asc" ? "ascending" : "descending") : "none");
            });

            sortTable(table, col, nextDirection);
            if (tableId === "openItemsTable") {
              applyOpenItemsFilter();
            }
            if (tableId === "scanTable") {
              applyScanFilter();
            }
          });
        });
      }

      function applyOpenItemsFilter() {
        if (!openItemsTable || !openItemsFilter || !openItemsNoMatch) {
          return;
        }

        var query = openItemsFilter.value.trim().toLowerCase();
        var rows = Array.prototype.slice.call(openItemsTable.tBodies[0].rows);
        var visibleCount = 0;

        rows.forEach(function (row) {
          var text = row.textContent.toLowerCase();
          var isVisible = query === "" || text.indexOf(query) !== -1;
          row.hidden = !isVisible;
          if (isVisible) {
            visibleCount += 1;
          }
        });

        var showNoMatch = openItemsState && openItemsState.value === "table" && visibleCount === 0;
        openItemsNoMatch.hidden = !showNoMatch;
      }

      function setOpenItemsState(state) {
        if (!openItemsWrap || !openItemsStates || !openItemsState) {
          return;
        }

        if (state === "table") {
          openItemsWrap.hidden = false;
          openItemsStates.hidden = true;
          openItemsNoMatch.hidden = true;
          applyOpenItemsFilter();
          return;
        }

        openItemsWrap.hidden = true;
        openItemsNoMatch.hidden = true;
        openItemsStates.hidden = false;

        var messages = Array.prototype.slice.call(openItemsStates.querySelectorAll(".table-state"));
        messages.forEach(function (msg) {
          msg.hidden = msg.getAttribute("data-state") !== state;
        });
      }

      function applyScanFilter() {
        if (!scanTable || !scanResultFilter) {
          return;
        }

        var wanted = scanResultFilter.value.toLowerCase();
        var rows = Array.prototype.slice.call(scanTable.tBodies[0].rows);
        rows.forEach(function (row) {
          var resultText = row.cells[3].textContent.trim().toLowerCase();
          var isVisible = wanted === "all" || resultText === wanted;
          row.hidden = !isVisible;
        });
      }

      function randomToken(length) {
        var chars = "abcdefghijklmnopqrstuvwxyz0123456789";
        var out = "";
        for (var i = 0; i < length; i++) {
          out += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return out;
      }

      if (keygenForm && keygenResult) {
        keygenForm.addEventListener("submit", function (event) {
          event.preventDefault();
          var name = document.getElementById("keyName").value.trim() || "dashboard-operator";
          var role = document.getElementById("keyRole").value;
          var env = document.getElementById("keyEnv").value;
          var key = "bl_" + role.slice(0, 3) + "_" + randomToken(24);
          var lines = [
            "# Template key generated from dashboard UI",
            "name=" + name,
            "role=" + role,
            "environment=" + env,
            "key=" + key,
            "",
            "# Example env setup",
            "BASELINE_API_KEYS=" + key + ":" + role
          ];
          keygenResult.textContent = lines.join("\n");
        });
      }

      if (openItemsFilter) {
        openItemsFilter.addEventListener("input", applyOpenItemsFilter);
      }
      if (openItemsState) {
        openItemsState.addEventListener("change", function () {
          setOpenItemsState(openItemsState.value);
        });
      }
      if (scanResultFilter) {
        scanResultFilter.addEventListener("change", applyScanFilter);
      }

      bindSortButtons();
      setOpenItemsState(openItemsState ? openItemsState.value : "table");
      applyScanFilter();

      window.addEventListener("hashchange", function () {
        var sectionFromHash = window.location.hash ? window.location.hash.slice(1) : "overview";
        if (validSectionId(sectionFromHash)) {
          showSection(sectionFromHash);
        }
      });

      var initialSection = window.location.hash ? window.location.hash.slice(1) : "overview";
      showSection(validSectionId(initialSection) ? initialSection : "overview");
    })();
  </script>
</body>
</html>
